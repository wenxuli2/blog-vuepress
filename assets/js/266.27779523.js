(window.webpackJsonp=window.webpackJsonp||[]).push([[266],{750:function(e,s,n){"use strict";n.r(s);var t=n(20),r=Object(t.a)({},(function(){var e=this,s=e.$createElement,n=e._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h1",{attrs:{id:"windows-商店指南"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#windows-商店指南"}},[e._v("#")]),e._v(" Windows 商店指南")]),e._v(" "),n("p",[e._v("在 Windows 10 中，一些不错的旧 win32 程序迎来了一个新朋友：通用 Windows 平台。 新的 "),n("code",[e._v(".appx")]),e._v(" 格式不仅启用了许多新的强大的 API，如 Cortana 或推送通知，而且通过 Windows 应用商店，也同时简化了安装和更新。")]),e._v(" "),n("p",[e._v("Microsoft "),n("a",{attrs:{href:"https://github.com/catalystcode/electron-windows-store",target:"_blank",rel:"noopener noreferrer"}},[e._v("开发了一个工具，将 Electron 应用程序编译为 "),n("code",[e._v(".appx")]),e._v(" 软件包"),n("OutboundLink")],1),e._v("，使开发人员能够使用新应用程序模型中的一些好东西。 本指南解释了如何使用它 - 以及 Electron AppX 包的功能和限制。")]),e._v(" "),n("h2",{attrs:{id:"背景和要求"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#背景和要求"}},[e._v("#")]),e._v(" 背景和要求")]),e._v(" "),n("p",[e._v('Windows 10 的 "周年更新" 能够运行 win32 '),n("code",[e._v(".exe")]),e._v(" 程序并且它们的虚拟化文件系统和注册表跟随一起启动。 两者都是通过在 Windows 容器中运行应用程序和安装器编译后创建的，允许 Windows 在安装过程中正确识别操作系统进行了哪些修改。 将可执行文件和虚拟文件系统与虚拟注册表配对, 允许 Windows 启用一键安装和卸载。")]),e._v(" "),n("p",[e._v("此外，exe 在 appx 模型内启动 - 这意味着它可以使用通用 Windows 平台可用的许多 API。 为了获得更多的功能，Electron 应用程序可以与一个看不见的 UWP 后台任务配合使用，它与 "),n("code",[e._v("exe")]),e._v(" 一起启动，作为后台运行任务的接收器，接收推送通知或与其他 UWP 应用程序通信 。")]),e._v(" "),n("p",[e._v("要编译任何现有的 Electron 应用程序，请确保满足以下要求:")]),e._v(" "),n("ul",[n("li",[e._v("Windows 10及周年更新 (2016年8月2日发布的)")]),e._v(" "),n("li",[e._v("Windows 10 SDK, "),n("a",{attrs:{href:"https://developer.microsoft.com/en-us/windows/downloads/windows-10-sdk",target:"_blank",rel:"noopener noreferrer"}},[e._v("这里下载"),n("OutboundLink")],1)]),e._v(" "),n("li",[e._v("最新的 Node 4 (运行 "),n("code",[e._v("node -v")]),e._v(" 来确认)")])]),e._v(" "),n("p",[e._v("然后, 安装 "),n("code",[e._v("electron-windows-store")]),e._v(" CLI:")]),e._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[e._v("npm")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" -g electron-windows-store\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br")])]),n("h2",{attrs:{id:"步骤-1-打包你的-electron-应用程序"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#步骤-1-打包你的-electron-应用程序"}},[e._v("#")]),e._v(" 步骤 1: 打包你的 Electron 应用程序")]),e._v(" "),n("p",[e._v("打包应用程序使用 "),n("a",{attrs:{href:"https://github.com/electron/electron-packager",target:"_blank",rel:"noopener noreferrer"}},[e._v("electron-packager"),n("OutboundLink")],1),e._v(" (或类似工具). 确保在最终的应用程序中删除不需要的 "),n("code",[e._v("node_modules")]),e._v(", 因为这些你不需要模块只会额外增加你的应用程序的大小.")]),e._v(" "),n("p",[e._v("结构输出应该看起来大致像这样:")]),e._v(" "),n("div",{staticClass:"language-plaintext line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-plaintext"}},[n("code",[e._v("├── Ghost.exe\n├── LICENSE\n├── content_resources_200_percent.pak\n├── content_shell.pak\n├── d3dcompiler_47.dll\n├── ffmpeg.dll\n├── icudtl.dat\n├── libEGL.dll\n├── libGLESv2.dll\n├── locales\n│   ├── am.pak\n│   ├── ar.pak\n│   ├── [...]\n├── node.dll\n├── resources\n│   └── app.asar\n├── v8_context_snapshot.bin\n├── squirrel.exe\n└── ui_resources_200_percent.pak\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br"),n("span",{staticClass:"line-number"},[e._v("18")]),n("br"),n("span",{staticClass:"line-number"},[e._v("19")]),n("br")])]),n("h2",{attrs:{id:"步骤-2-运行-electron-windows-store"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#步骤-2-运行-electron-windows-store"}},[e._v("#")]),e._v(" 步骤 2: 运行 electron-windows-store")]),e._v(" "),n("p",[e._v("从提权的 PowerShell(用管理员身份运行它) 中, 以所需的参数运行 "),n("code",[e._v("electron-windows-store")]),e._v("，传递输入和输出目录，应用程序的名称和版本，以及确认 "),n("code",[e._v("node_modules")]),e._v(" 应该是扁平的。")]),e._v(" "),n("div",{staticClass:"language-powershell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-powershell"}},[n("code",[e._v("electron-windows-store `\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("--")]),e._v("input-directory C:\\myelectronapp `\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("--")]),e._v("output-directory C:\\output\\myelectronapp `\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("--")]),e._v("package-version 1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("0 `\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("--")]),e._v("package-name myelectronapp\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br")])]),n("p",[e._v("一旦执行，工具就开始工作：它接受您的 Electron 应用程序作为输入，展平 "),n("code",[e._v("node_modules")]),e._v("。 然后，它将应用程序归档为 "),n("code",[e._v("app.zip")]),e._v("。 使用安装程序和 Windows 容器，该工具创建一个“扩展的” AppX 包 - 包括 Windows 应用程序清单 ("),n("code",[e._v("AppXManifest.xml")]),e._v(")以及虚拟文件系统和输出文件夹中的虚拟注册表。")]),e._v(" "),n("p",[e._v("当创建扩展的 AppX 文件后，该工具使用 Windows App Packager("),n("code",[e._v("MakeAppx.exe")]),e._v(")将磁盘上的这些文件创建为单文件 AppX 包。 最后，该工具可用于在计算机上创建可信证书，以签署新的 AppX 包。 使用签名的 AppX 软件包，CLI也可以自动在您的计算机上安装软件包。")]),e._v(" "),n("h2",{attrs:{id:"步骤-3-使用-appx-包"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#步骤-3-使用-appx-包"}},[e._v("#")]),e._v(" 步骤 3: 使用 AppX 包")]),e._v(" "),n("p",[e._v("为了运行您的软件包，您的用户将需要将 Windows 10 安装“周年纪念更新” - 有关如何更新Windows的详细信息可以在"),n("a",{attrs:{href:"https://blogs.windows.com/windowsexperience/2016/08/02/how-to-get-the-windows-10-anniversary-update",target:"_blank",rel:"noopener noreferrer"}},[e._v("这里"),n("OutboundLink")],1),e._v("找到")]),e._v(" "),n("p",[e._v("与传统的UWP应用程序不同，打包应用程序目前需要进行手动验证过程，您可以在"),n("a",{attrs:{href:"https://developer.microsoft.com/en-us/windows/projects/campaigns/desktop-bridge",target:"_blank",rel:"noopener noreferrer"}},[e._v("这里"),n("OutboundLink")],1),e._v("申请. 在此期间，所有用户都能够通过双击安装包来安装您的程序，所以如果您只是寻找一个更简单的安装方法，可能不需要提交到商店。 在受管理的环境中(通常是企业), "),n("code",[e._v("Add-AppxPackage")]),e._v(" "),n("a",{attrs:{href:"https://technet.microsoft.com/en-us/library/hh856048.aspx",target:"_blank",rel:"noopener noreferrer"}},[e._v("PowerShell Cmdlet 可用于以自动方式安装它"),n("OutboundLink")],1),e._v("。")]),e._v(" "),n("p",[e._v("另一个重要的限制是编译的 AppX 包仍然包含一个 win32 可执行文件，因此不会在 Xbox，HoloLens 或 Phones 中运行。")]),e._v(" "),n("h2",{attrs:{id:"可选-使用-backgroundtask-添加-uwp-功能"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#可选-使用-backgroundtask-添加-uwp-功能"}},[e._v("#")]),e._v(" 可选: 使用 BackgroundTask 添加 UWP 功能")]),e._v(" "),n("p",[e._v("您可以将 Electron 应用程序与不可见的 UWP 后台任务配对，以充分利用 Windows 10 功能，如推送通知，Cortana 集成或活动磁贴。")]),e._v(" "),n("p",[e._v("如何使用 Electron 应用程序通过后台任务发送 Toast 通知和活动磁贴, 请"),n("a",{attrs:{href:"https://github.com/felixrieseberg/electron-uwp-background",target:"_blank",rel:"noopener noreferrer"}},[e._v("查看微软提供的案例"),n("OutboundLink")],1),e._v(".")]),e._v(" "),n("h2",{attrs:{id:"可选-使用容器虚拟化进行转换"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#可选-使用容器虚拟化进行转换"}},[e._v("#")]),e._v(" 可选: 使用容器虚拟化进行转换")]),e._v(" "),n("p",[e._v("要生成 AppX 包，"),n("code",[e._v("electron-windows-store")]),e._v(" CLI 使用的模板应该适用于大多数 Electron 应用程序。 但是，如果您使用自定义安装程序，或者您遇到生成的包的任何问题，您可以尝试使用 Windows 容器编译创建包 - 在该模式下，CLI 将在空 Windows 容器中安装和运行应用程序，以确定应用程序正在对操作系统进行哪些修改。")]),e._v(" "),n("p",[e._v("在第一次运行 CLI 之前，您必须安装 “Windows Desktop App Converter” 。 这将需要几分钟，但不要担心 - 你只需要这样做一次。 从"),n("a",{attrs:{href:"https://docs.microsoft.com/en-us/windows/uwp/porting/desktop-to-uwp-run-desktop-app-converter",target:"_blank",rel:"noopener noreferrer"}},[e._v("这里"),n("OutboundLink")],1),e._v("下载 Desktop App Converter 您将得到两个文件： "),n("code",[e._v("DesktopAppConverter.zip")]),e._v(" 和 "),n("code",[e._v("BaseImage-14316.wim")]),e._v(".")]),e._v(" "),n("ol",[n("li",[e._v("解压 "),n("code",[e._v("DesktopAppConverter.zip")]),e._v('. 打开提权的 PowerShell (用"以管理员权限运行"打开, 确保您的系统执行策略允许我们通过调用 '),n("code",[e._v("Set-ExecutionPolicy bypass")]),e._v(" 来运行我们想要运行的一切).")]),e._v(" "),n("li",[e._v("然后, 通过调用 "),n("code",[e._v(".\\DesktopAppConverter.ps1 -Setup -BaseImage .\\BaseImage-14316.wim")]),e._v(", 运行 Desktop App Converter 安装，并传递 Windows 基本映像的位置 (下载的 "),n("code",[e._v("BaseImage-14316.wim")]),e._v(").")]),e._v(" "),n("li",[e._v("如果运行以上命令提示您重新启动，请重新启动计算机，并在成功重新启动后再次运行上述命令。")])]),e._v(" "),n("p",[e._v("当安装成功后，您可以继续编译你的 Electron 应用程序。")])])}),[],!1,null,null,null);s.default=r.exports}}]);