(window.webpackJsonp=window.webpackJsonp||[]).push([[59],{535:function(e,t,r){"use strict";r.r(t);var a=r(20),o=Object(a.a)({},(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h1",{attrs:{id:"autoupdater"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#autoupdater"}},[e._v("#")]),e._v(" autoUpdater")]),e._v(" "),r("blockquote",[r("p",[e._v("使应用程序能够自动更新")])]),e._v(" "),r("p",[e._v("进程："),r("RouterLink",{attrs:{to:"/《Electron中文文档》/glossary.html#main-process"}},[e._v("主进程")])],1),e._v(" "),r("p",[r("strong",[e._v("请参阅：在应用程序中如何实现更新的详细指南。")])]),e._v(" "),r("p",[r("code",[e._v("autoUpdater")]),e._v("是一个"),r("a",{attrs:{href:"https://nodejs.org/api/events.html#events_class_eventemitter",target:"_blank",rel:"noopener noreferrer"}},[e._v("EventEmitter"),r("OutboundLink")],1),e._v(".")]),e._v(" "),r("h2",{attrs:{id:"跨平台提醒"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#跨平台提醒"}},[e._v("#")]),e._v(" 跨平台提醒")]),e._v(" "),r("p",[e._v("目前只支持 macOS 和 Windows 版本。 在 Linux 上没有内置的自动更新程序，因此建议使用发行版包管理器来更新您的应用程序。")]),e._v(" "),r("p",[e._v("此外，每个平台都有一些细微的差别:")]),e._v(" "),r("h3",{attrs:{id:"macos"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#macos"}},[e._v("#")]),e._v(" macOS")]),e._v(" "),r("p",[e._v("在macOS上, "),r("code",[e._v("autoUpdater")]),e._v("模块建立在 "),r("a",{attrs:{href:"https://github.com/Squirrel/Squirrel.Mac",target:"_blank",rel:"noopener noreferrer"}},[e._v("Squirrel.Mac"),r("OutboundLink")],1),e._v("上,这意味着你不需要任何特殊的设置来使它工作。 对于服务器端要求, 你可以阅读 "),r("a",{attrs:{href:"https://github.com/Squirrel/Squirrel.Mac#server-support",target:"_blank",rel:"noopener noreferrer"}},[e._v("Server Support"),r("OutboundLink")],1),e._v(". 注意"),r("a",{attrs:{href:"https://developer.apple.com/library/content/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html#//apple_ref/doc/uid/TP40009251-SW35",target:"_blank",rel:"noopener noreferrer"}},[e._v("App Transport Security"),r("OutboundLink")],1),e._v(" (ATS) 适用于所有请求作为更新过程的一部分。</0> 如需禁用ATS的应用程序可以在其应用程序的plist中添加 "),r("code",[e._v("NSAllowsArbitraryLoads")]),e._v("属性。")]),e._v(" "),r("p",[r("strong",[e._v("注意：")]),e._v(" 在 macOS 上，您的应用程序必须得到签名后方可自动更新。 这是 "),r("code",[e._v("Squirrel.Mac")]),e._v(" 的要求。")]),e._v(" "),r("h3",{attrs:{id:"windows"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#windows"}},[e._v("#")]),e._v(" Windows")]),e._v(" "),r("p",[e._v("在 Windows 上, 你必须将应用程序安装在用户的计算机上才能使用"),r("code",[e._v("autoUpdater")]),e._v(", 所以推荐使用 "),r("a",{attrs:{href:"https://github.com/electron/windows-installer",target:"_blank",rel:"noopener noreferrer"}},[e._v("electron-winstaller"),r("OutboundLink")],1),e._v(", "),r("a",{attrs:{href:"https://github.com/electron-userland/electron-forge",target:"_blank",rel:"noopener noreferrer"}},[e._v("electron-forge"),r("OutboundLink")],1),e._v(" 或者 "),r("a",{attrs:{href:"https://github.com/electron/grunt-electron-installer",target:"_blank",rel:"noopener noreferrer"}},[e._v("grunt-electron-installer"),r("OutboundLink")],1),e._v(" 模块来生成Windows安装程序。")]),e._v(" "),r("p",[e._v("当使用 "),r("a",{attrs:{href:"https://github.com/electron/windows-installer",target:"_blank",rel:"noopener noreferrer"}},[e._v("electron-winstaller"),r("OutboundLink")],1),e._v(" 或 "),r("a",{attrs:{href:"https://github.com/electron-userland/electron-forge",target:"_blank",rel:"noopener noreferrer"}},[e._v("electron-forge"),r("OutboundLink")],1),e._v(" 时，请确保不要在"),r("a",{attrs:{href:"https://github.com/electron/windows-installer#handling-squirrel-events",target:"_blank",rel:"noopener noreferrer"}},[e._v("第一次运行"),r("OutboundLink")],1),e._v("你的应用程序时进行更新操作(也可查看这个 "),r("a",{attrs:{href:"https://github.com/electron/electron/issues/7155",target:"_blank",rel:"noopener noreferrer"}},[e._v("issue获取更多信息"),r("OutboundLink")],1),e._v(")。 还建议使用 "),r("a",{attrs:{href:"https://github.com/mongodb-js/electron-squirrel-startup",target:"_blank",rel:"noopener noreferrer"}},[e._v("electron-squirrel-startup"),r("OutboundLink")],1),e._v(" 来创建应用程序的桌面快捷方式。")]),e._v(" "),r("p",[e._v("使用Squirrel生成的安装程序将以 "),r("code",[e._v("com.squirrel.PACKAGE_ID.YOUR_EXE_WITHOUT_DOT_EXE")]),e._v(" 的格式创建一个带有 "),r("a",{attrs:{href:"https://msdn.microsoft.com/en-us/library/windows/desktop/dd378459(v=vs.85).aspx",target:"_blank",rel:"noopener noreferrer"}},[e._v("Application User Model ID"),r("OutboundLink")],1),e._v(" 的快捷图标，例子是 "),r("code",[e._v("com.squirrel.slack.Slack")]),e._v(" 和 "),r("code",[e._v("com.squirrel.code.Code")]),e._v("。 你应该在自己的应用中使用 "),r("code",[e._v("app.setAppUserModelId")]),e._v(" API 方法设置相同的 API和ID，不然 Windows 将不能正确地把你的应用固定在任务栏上。")]),e._v(" "),r("p",[e._v("Like Squirrel.Mac, Windows can host updates on S3 or any other static file host. 你可以阅读 "),r("a",{attrs:{href:"https://github.com/Squirrel/Squirrel.Windows",target:"_blank",rel:"noopener noreferrer"}},[e._v("Squirrel.Windows"),r("OutboundLink")],1),e._v("的文档来获得更多关于 Squirrel.Windows 是如何工作的信息。")]),e._v(" "),r("h2",{attrs:{id:"事件"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#事件"}},[e._v("#")]),e._v(" 事件")]),e._v(" "),r("p",[r("code",[e._v("autoUpdater")]),e._v(" 对象会触发以下的事件:")]),e._v(" "),r("h3",{attrs:{id:"event-error"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#event-error"}},[e._v("#")]),e._v(" Event: 'error'")]),e._v(" "),r("p",[e._v("返回:")]),e._v(" "),r("ul",[r("li",[r("code",[e._v("error")]),e._v(" Error")])]),e._v(" "),r("p",[e._v("当更新发生错误的时候触发。")]),e._v(" "),r("h3",{attrs:{id:"event-checking-for-update"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#event-checking-for-update"}},[e._v("#")]),e._v(" Event: 'checking-for-update'")]),e._v(" "),r("p",[e._v("当开始检查更新的时候触发。")]),e._v(" "),r("h3",{attrs:{id:"event-update-available"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#event-update-available"}},[e._v("#")]),e._v(" Event: 'update-available'")]),e._v(" "),r("p",[e._v("当有可用更新的时候触发。 更新将自动下载。")]),e._v(" "),r("h3",{attrs:{id:"event-update-not-available"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#event-update-not-available"}},[e._v("#")]),e._v(" Event: 'update-not-available'")]),e._v(" "),r("p",[e._v("当没有可用更新的时候触发。")]),e._v(" "),r("h3",{attrs:{id:"event-update-downloaded"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#event-update-downloaded"}},[e._v("#")]),e._v(" Event: 'update-downloaded'")]),e._v(" "),r("p",[e._v("返回:")]),e._v(" "),r("ul",[r("li",[r("code",[e._v("event")]),e._v(" Event")]),e._v(" "),r("li",[r("code",[e._v("releaseNotes")]),e._v(" String")]),e._v(" "),r("li",[r("code",[e._v("releaseName")]),e._v(" String")]),e._v(" "),r("li",[r("code",[e._v("releaseDate")]),e._v(" Date")]),e._v(" "),r("li",[r("code",[e._v("updateURL")]),e._v(" String")])]),e._v(" "),r("p",[e._v("在更新下载完成的时候触发。")]),e._v(" "),r("p",[e._v("在 Windows 上只有 "),r("code",[e._v("releaseName")]),e._v(" 是有效的。")]),e._v(" "),r("p",[r("strong",[e._v("注意：")]),e._v(" 此事件并不一定需要处理。 成功下载的更新仍将在应用程序下次启动时应用。")]),e._v(" "),r("h3",{attrs:{id:"event-before-quit-for-update"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#event-before-quit-for-update"}},[e._v("#")]),e._v(" Event:  'before-quit-for-update'")]),e._v(" "),r("p",[e._v("此事件是在用户调用"),r("code",[e._v("quitAndInstall()")]),e._v("之后发出的。")]),e._v(" "),r("p",[e._v("当此API被调用时，会在所有窗口关闭之前发出 "),r("code",[e._v("before-quit")]),e._v(" 事件。 因此，如果您希望在关闭窗口进程退出之前执行操作，则应该侦听此事件，以及侦听 "),r("code",[e._v("before-quit")]),e._v("。")]),e._v(" "),r("h2",{attrs:{id:"方法"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#方法"}},[e._v("#")]),e._v(" 方法")]),e._v(" "),r("p",[r("code",[e._v("autoUpdater")]),e._v(" 对象具有以下方法:")]),e._v(" "),r("h3",{attrs:{id:"autoupdater-setfeedurl-选项"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#autoupdater-setfeedurl-选项"}},[e._v("#")]),e._v(" "),r("code",[e._v("autoUpdater.setFeedURL(选项)")])]),e._v(" "),r("ul",[r("li",[r("code",[e._v("选项")]),e._v(" 对象\n"),r("ul",[r("li",[r("code",[e._v("url")]),e._v(" String")]),e._v(" "),r("li",[r("code",[e._v("headers")]),e._v(" Record<String, String> (可选) "),r("em",[e._v("macOS")]),e._v(" - HTTP 请求头。")]),e._v(" "),r("li",[r("code",[e._v("serverType")]),e._v(" String(可选) "),r("em",[e._v("macOS")]),e._v(" - 可以是"),r("code",[e._v("json")]),e._v(" 或者 "),r("code",[e._v("default")]),e._v(",查看 "),r("a",{attrs:{href:"https://github.com/Squirrel/Squirrel.Mac",target:"_blank",rel:"noopener noreferrer"}},[e._v("Squirrel.Mac"),r("OutboundLink")],1),e._v(" 的README文件获取更多详细信息。")])])])]),e._v(" "),r("p",[e._v("设置检查更新的 "),r("code",[e._v("url")]),e._v("，并且初始化自动更新。")]),e._v(" "),r("h3",{attrs:{id:"autoupdater-getfeedurl"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#autoupdater-getfeedurl"}},[e._v("#")]),e._v(" "),r("code",[e._v("autoUpdater.getFeedURL()")])]),e._v(" "),r("p",[e._v("返回 "),r("code",[e._v("String")]),e._v(" - 获取当前更新的 Feed 链接.")]),e._v(" "),r("h3",{attrs:{id:"autoupdater-checkforupdates"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#autoupdater-checkforupdates"}},[e._v("#")]),e._v(" "),r("code",[e._v("autoUpdater.checkForUpdates()")])]),e._v(" "),r("p",[e._v("询问服务器是否有更新。 在使用此 API 之前，您必须调用"),r("code",[e._v("setFeedURL")]),e._v(" 。")]),e._v(" "),r("p",[r("strong",[e._v("Note:")]),e._v(" If an update is available it will be downloaded automatically. Calling "),r("code",[e._v("autoUpdater.checkForUpdates()")]),e._v(" twice will download the update two times.")]),e._v(" "),r("h3",{attrs:{id:"autoupdater-quitandinstall"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#autoupdater-quitandinstall"}},[e._v("#")]),e._v(" "),r("code",[e._v("autoUpdater.quitAndInstall()")])]),e._v(" "),r("p",[e._v("重启应用并在下载后安装更新。 它只应在发出 "),r("code",[e._v("update-downloaded")]),e._v(" 后方可被调用。")]),e._v(" "),r("p",[e._v("在此机制下，调用 "),r("code",[e._v("autoUpdater.quitAndInstall()")]),e._v(" 将首先关闭所有应用程序窗口，并且在所有窗口都关闭之后自动调用 "),r("code",[e._v("app.quit()")])]),e._v(" "),r("p",[r("strong",[e._v("注意:")]),e._v(" 严格来讲，执行一次自动更新不一定要调用此方法。因为下载更新文件成功之后，下次应用启动的时候会强制更新。")])])}),[],!1,null,null,null);t.default=o.exports}}]);