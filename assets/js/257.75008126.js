(window.webpackJsonp=window.webpackJsonp||[]).push([[257],{735:function(s,t,a){"use strict";a.r(t);var e=a(20),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"headless-ci-systems-测试-travis-ci-jenkins"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#headless-ci-systems-测试-travis-ci-jenkins"}},[s._v("#")]),s._v(" Headless CI Systems 测试 (Travis CI, Jenkins)")]),s._v(" "),a("p",[s._v("Electron 基于 Chromium，所以需要一个显示驱动使其运转。 如果 Chromium 无法找到一个显示驱动， Electron 会启动失败，因此无论你如何去运行它，Electron 不会执行你的任何测试。 在 Travis，Circle， Jenkins 或者类似的系统上测试基于Electron的应用时，需要进行一些配置。 本质上，我们需要使用一个 虚拟的显示驱动。")]),s._v(" "),a("h2",{attrs:{id:"配置虚拟显示服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置虚拟显示服务器"}},[s._v("#")]),s._v(" 配置虚拟显示服务器")]),s._v(" "),a("p",[s._v("首先安装 "),a("a",{attrs:{href:"https://en.wikipedia.org/wiki/Xvfb",target:"_blank",rel:"noopener noreferrer"}},[s._v("Xvfb"),a("OutboundLink")],1),s._v(". 这是一个虚拟的帧缓冲，实现了X11显示服务协议，所有的图形操作都在内存中表现，而不需要显示在 任何屏幕输出设备上。这正是我们所需要的。")]),s._v(" "),a("p",[s._v("然后创建一个虚拟屏幕实例(Xvfb), 并导出 DISPLAY 变量, 该变量存储虚拟屏幕的引用. Electron 中的 Chromium 会自动的去寻找 "),a("code",[s._v("$DISPLAY")]),s._v("，所以你的应用不需要再去进行配置 这一步可以通过 Paul Betts 的 "),a("a",{attrs:{href:"https://github.com/anaisbetts/xvfb-maybe",target:"_blank",rel:"noopener noreferrer"}},[s._v("xvfb-maybe"),a("OutboundLink")],1),s._v(" 实现自动化：如果系统需要，在"),a("code",[s._v("xvfb-maybe")]),s._v("前加上你的测试命令 然后这个小工具会自动的设置 xvfb。 在 Windows 或 macOS ，它不会执行任何东西。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 在 Windows 或者 macOS，这只是调用 electron-mocha")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 在 Linux， 如果我们在一个 headless 环境，这将是等同于")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 执行 xvfb-run electron-mocha ./test/*.js")]),s._v("\nxvfb-maybe electron-mocha ./test/*.js\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"travis-ci"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#travis-ci"}},[s._v("#")]),s._v(" Travis CI")]),s._v(" "),a("p",[s._v("在 Travis 上, 你的 "),a("code",[s._v(".travis.yml")]),s._v(" 应该和下面的代码相似:")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("addons")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("packages")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" xvfb\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("install")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" export DISPLAY='"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("99.0'\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" Xvfb "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("99 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("screen 0 1024x768x24 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(" /dev/null 2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token important"}},[s._v("&1")]),s._v(" &\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h3",{attrs:{id:"jenkins"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jenkins"}},[s._v("#")]),s._v(" Jenkins")]),s._v(" "),a("p",[s._v("Jenkins下, 有一个"),a("a",{attrs:{href:"https://wiki.jenkins-ci.org/display/JENKINS/Xvfb+Plugin",target:"_blank",rel:"noopener noreferrer"}},[s._v("可用的 Xvfb 插件"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("h3",{attrs:{id:"circle-ci"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#circle-ci"}},[s._v("#")]),s._v(" Circle CI")]),s._v(" "),a("p",[s._v("Circle CI is awesome and has Xvfb and "),a("code",[s._v("$DISPLAY")]),s._v(" "),a("a",{attrs:{href:"https://circleci.com/docs/environment#browsers",target:"_blank",rel:"noopener noreferrer"}},[s._v("already set up, so no further configuration is required"),a("OutboundLink")],1),s._v(".")]),s._v(" "),a("h3",{attrs:{id:"appveyor"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#appveyor"}},[s._v("#")]),s._v(" AppVeyor")]),s._v(" "),a("p",[s._v("AppVeyor 运行于 Windows 上，支持 Selenium，Chromium，Electron 以及一些类似的工具，开箱即用，无需配置")])])}),[],!1,null,null,null);t.default=n.exports}}]);